<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OBS Timer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .hero {
      text-align: center;
      margin-bottom: 60px;
    }

    .hero h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .hero p {
      font-size: 1.25rem;
      color: #94a3b8;
    }

    .quick-start {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .quick-start h2 {
      font-size: 1.5rem;
      margin-bottom: 24px;
    }

    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .input-group input {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      padding: 14px 18px;
      border-radius: 10px;
      font-size: 16px;
    }

    .input-group input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .input-group input::placeholder {
      color: #64748b;
    }

    .input-group button {
      background: #3b82f6;
      color: #fff;
      border: none;
      padding: 14px 28px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .input-group button:hover {
      background: #2563eb;
    }

    .section {
      margin-bottom: 40px;
    }

    .section h2 {
      font-size: 1.5rem;
      margin-bottom: 16px;
      color: #fff;
    }

    .section h3 {
      font-size: 1.125rem;
      margin-bottom: 8px;
      color: #e2e8f0;
    }

    .section p, .section li {
      color: #94a3b8;
      line-height: 1.7;
    }

    .section ul, .section ol {
      padding-left: 24px;
      margin-bottom: 16px;
    }

    .section li {
      margin-bottom: 8px;
    }

    .code {
      background: rgba(0,0,0,0.3);
      padding: 4px 8px;
      border-radius: 4px;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.9em;
      color: #e2e8f0;
    }

    .code-block {
      background: rgba(0,0,0,0.3);
      padding: 16px;
      border-radius: 8px;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.9em;
      overflow-x: auto;
      margin: 16px 0;
    }

    .tip {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid #3b82f6;
      padding: 16px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }

    .tip p {
      color: #e2e8f0;
      margin: 0;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .feature {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 12px;
    }

    .feature h4 {
      font-size: 1rem;
      margin-bottom: 8px;
      color: #fff;
    }

    .feature p {
      font-size: 0.875rem;
      margin: 0;
    }

    .error-banner {
      display: none;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .error-banner.show {
      display: block;
    }

    footer {
      text-align: center;
      color: #64748b;
      font-size: 0.875rem;
      margin-top: 60px;
      padding-bottom: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <h1>OBS Timer</h1>
      <p>Countdown and countup timer overlay for OBS</p>
    </div>

    <div id="error-banner" class="error-banner"></div>

    <div class="quick-start">
      <h2>Quick Start</h2>
      <p style="color: #94a3b8; margin-bottom: 16px;">Enter a room name to create your timer. Use any name you like, it's just for separating different timers.</p>

      <div class="input-group">
        <input type="text" id="room-input" placeholder="Enter room name (e.g., mystream)">
        <button id="go-btn">Open Control Panel</button>
      </div>

      <p style="color: #64748b; font-size: 0.875rem;">No account needed. Your room is created automatically.</p>
    </div>

    <div class="section">
      <h2>How It Works</h2>

      <div class="features">
        <div class="feature">
          <h4>Multi-Room Support</h4>
          <p>Each room is independent. Create as many rooms as needed.</p>
        </div>
        <div class="feature">
          <h4>Real-Time Sync</h4>
          <p>Control panel and OBS overlay update instantly via WebSocket.</p>
        </div>
        <div class="feature">
          <h4>Customizable</h4>
          <p>Adjust font, size, colors, shadows, and more from the control panel.</p>
        </div>
        <div class="feature">
          <h4>Persistent</h4>
          <p>Timer state and settings are saved. Survives server restarts.</p>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Setting Up in OBS</h2>

      <ol>
        <li>Open OBS Studio and go to your scene</li>
        <li>Click the <strong>+</strong> button under Sources and select <strong>Browser</strong></li>
        <li>Name it "Timer" (or whatever you prefer)</li>
        <li>Set the URL to your overlay URL:
          <div class="code-block" id="obs-url-example"></div>
        </li>
        <li>Click <strong>OK</strong></li>
      </ol>

      <div class="tip">
        <p><strong>Tip:</strong> The overlay has a transparent background. Position and resize the source to place the timer where you want it on screen.</p>
      </div>
    </div>

    <div class="section">
      <h2>URL Reference</h2>

      <h3>Control Panel</h3>
      <p>Use this URL to control your timer from any browser:</p>
      <div class="code-block">/control?room=yourroomname</div>

      <h3>OBS Overlay</h3>
      <p>Use this URL in OBS Browser Source:</p>
      <div class="code-block">/overlay?room=yourroomname</div>

      <h3>API Endpoint</h3>
      <p>Get current timer state as JSON (for integrations):</p>
      <div class="code-block">/api/room/yourroomname</div>
    </div>

    <div class="section">
      <h2>Timer Modes</h2>

      <h3>Countdown</h3>
      <p>Counts down from a set duration. Configurable end behavior:</p>
      <ul>
        <li><strong>Stop at 00:00</strong> - Timer stops when it reaches zero</li>
        <li><strong>Count into negative</strong> - Continues counting as -00:01, -00:02, etc.</li>
        <li><strong>Hide timer</strong> - Timer disappears when it reaches zero</li>
      </ul>

      <h3>Count Up</h3>
      <p>Counts up from zero. Great for tracking elapsed time.</p>
    </div>

    <div class="section">
      <h2>Duration Format</h2>
      <p>You can enter durations in various formats:</p>
      <ul>
        <li><span class="code">5:00</span> or <span class="code">5m</span> - 5 minutes</li>
        <li><span class="code">1:30:00</span> or <span class="code">1h30m</span> - 1 hour 30 minutes</li>
        <li><span class="code">90</span> or <span class="code">90s</span> - 90 seconds</li>
        <li><span class="code">2:30</span> - 2 minutes 30 seconds</li>
      </ul>
    </div>

    <footer>
      OBS Timer - Self-hosted timer overlay
    </footer>
  </div>

  <script>
    // Set dynamic URL examples
    const baseUrl = window.location.origin;
    document.getElementById('obs-url-example').textContent = `${baseUrl}/overlay?room=yourroomname`;

    // Check for error in URL
    const params = new URLSearchParams(window.location.search);
    const error = params.get('error');
    if (error === 'missing_room') {
      const banner = document.getElementById('error-banner');
      banner.textContent = 'Please enter a room name to access the control panel or overlay.';
      banner.classList.add('show');
    }

    // Handle quick start form
    const roomInput = document.getElementById('room-input');
    const goBtn = document.getElementById('go-btn');

    function goToRoom() {
      const room = roomInput.value.trim().toLowerCase().replace(/[^a-z0-9_-]/g, '');
      if (room) {
        window.location.href = `/control?room=${room}`;
      } else {
        roomInput.focus();
      }
    }

    goBtn.addEventListener('click', goToRoom);
    roomInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        goToRoom();
      }
    });
  </script>
</body>
</html>
